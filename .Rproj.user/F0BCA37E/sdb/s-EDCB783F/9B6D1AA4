{
    "contents" : "library(rgdal)\nlibrary(foreign)\nlibrary(PBSmapping)\nlibrary(maptools)\ny=readOGR(\"C:/Users/Remi-Work/Documents/ArcGIS\",\"Inuit\")\ninuit_data=read.dbf(\"C:/Users/Remi-Work/Documents/ArcGIS/Inuit.dbf\")\n\n#projection <- CRS(\"+proj=lcc +lon_0=-92.8667 +units=m\")\n#projection <- CRS(\"+proj=stere +lat_0=90 +lat_ts=70 +lon_0=-45 +k=1 +x_0=0 +y_0=0 +a=6378273 +b=6356889.449 +units=m +no_defs\")\nprojection = CRS(\"+proj=stere +lat_0=90 +lat_ts=70 +lon_0=-45 +k=1 +x_0=0 +y_0=0 +ellps=WGS84 +datum=WGS84 +units=m +no_defs\")\n#projection=CRS(\"+proj=ups\")\ninuit=spTransform(y,projection)\n\n\n\n### create circle function\ncircle <- function(lonlatpoint, radius) {\n  travelvector <- as.data.frame(cbind(direction = seq(0, 2*pi, by=2*pi/100), magnitude = radius))\n  Rearth <- 6372795\n  Dd <- travelvector$magnitude / Rearth\n  Cc <- travelvector$direction\n  \n  if (class(lonlatpoint) == \"SpatialPoints\") {\n    lata <- coordinates(lonlatpoint)[1,2] * (pi/180)\n    lona <- coordinates(lonlatpoint)[1,1] * (pi/180)\n  }\n  else {\n    lata <- lonlatpoint[2] * (pi/180)\n    lona <- lonlatpoint[1] * (pi/180)\n  }\n  latb <- asin(cos(Cc) * cos(lata) * sin(Dd) + sin(lata) \n               * cos(Dd))\n  dlon <- atan2(cos(Dd) - sin(lata) * sin(latb), sin(Cc) \n                * sin(Dd) * cos(lata))\n  lonb <- lona - dlon + pi/2\n  \n  lonb[lonb >  pi] <- lonb[lonb >  pi] - 2 * pi\n  lonb[lonb < -pi] <- lonb[lonb < -pi] + 2 * pi\n  \n  latb <- latb * (180 / pi)\n  lonb <- lonb * (180 / pi)\n  \n  cbind(longitude = lonb, latitude = latb)\n}\n\n\n### Calculated overlapping area Ice+ring\n\nfilelist=list.files(\"C:/Users/Remi-Work/Documents/ArcGIS/NSIDC Sea Ice/shapefiles\",pattern=\".shp\")\nfilelist=substr(filelist,1,23)\ncover=data.frame(matrix(NA,nrow=length(filelist),ncol=length(inuit_data$Long_X)))\ncover$filename=cover[,1]\n\nfor(t in 1:length(filelist)){\n  x=readOGR(\"C:/Users/Remi-Work/Documents/ArcGIS/NSIDC Sea Ice/shapefiles\",layer=as.character(filelist[t]))\n  ice=spTransform(x,projection)\n  for(i in 1:length(inuit_data$Long_X)){\n    c1 = circle(cbind(inuit_data$Long_X[i], inuit_data$Lat_Y[i]),inuit_data$Distance[i]+500000)\n    r1 = rbind(c1, c1[1, ])  # join\n    P1 = Polygon(r1)\n    Ps1 = Polygons(list(P1), ID = \"a\")\n    Ps2 = SpatialPolygons(list(Ps1),c(1:length(Ps1)),CRS(\"+proj=longlat +datum=WGS84 +x_0=0 +y_0=0\"))\n    SPDF = SpatialPolygonsDataFrame(Ps2, data.frame(N = c(\"one\"), row.names = c(\"a\")))      \n    ring=spTransform(SPDF,projection)  \n    #plot(ice)\n    #plot(ring,add=T)\n    #title(paste(\"t=\",as.character(t),\"i=\",as.character(i)))\n    print(paste(\"t=\",as.character(t),\"i=\",as.character(i)))\n    ice2=combinePolys(SpatialPolygons2PolySet(ice))\n    ring2=combinePolys(SpatialPolygons2PolySet(ring))\n    res=try(combinePolys(joinPolys(ice2,ring2,\"INT\")),silent=T)\n    if(class(res)==\"try-error\"){\n      cover[t,i]=0\n    }else{\n      overlap=res\n      cover[t,i]=sum(calcArea(overlap, rollup=1)$area)\n    }\n\n    cover$filename[t]=filelist[t]\n  }\n}\ncover$year=substr(cover$filename,10,13)\ncover$month=substr(cover$filename,14,15)\n\n\n### calculate percent cover\npcover=cover\nfor(i in 1:length(inuit_data$Long_X)){\n  pcover[,i]=cover[,i]/max(cover[,i])\n  plot(c(1:length(filelist)),pcover[,i],\"l\")\n}\n\n### calculate mean trend\npcover$mean=pcover$month\nfor(i in 1:length(filelist)){\n  pcover$mean[i]=mean(as.numeric(pcover[i,1:length(inuit_data$Long_X)]))\n}\nplot(c(1:length(filelist)),pcover$mean,\"l\")\n\n\n### remove 0's and 1's\npcover2=pcover\nfor(j in 1:length(inuit_data$Long_X)){\n  for(i in 1:12){\n    index=as.numeric(pcover2$month)==i\n    if(mean(pcover[index,j])==1) {pcover2[index,j]=NA}\n    if(mean(pcover[index,j])==0) {pcover2[index,j]=NA}\n  }\n}\n\n\n### calculate yearly pattern\nice_index_byyear=data.frame(matrix(NA,nrow=length(years),ncol=length(inuit_data$Long_X)))\nice_index_byyear2=ice_index_byyear\nyears=unique(pcover$year)[2:length(unique(pcover$year))]\nfor(j in 1:length(inuit_data$Long_X)){\n  for(i in 1:length(years)){\n    index=as.numeric(pcover2$year)==years[i]\n    ice_index_byyear[i,j]=mean(pcover[index,j],na.rm=T)\n    ice_index_byyear2[i,j]=mean(pcover2[index,j],na.rm=T)\n  }\n}\nice_index_byyear$mean=rowMeans(ice_index_byyear)\nplot(years,ice_index_byyear$mean,\"l\")\nice_index_byyear2$mean=rowMeans(ice_index_byyear2)\nplot(years,ice_index_byyear2$mean,\"l\")\n",
    "created" : 1390331330747.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "16|41|43|0|\n53|29|80|0|\n",
    "hash" : "3125380445",
    "id" : "9B6D1AA4",
    "lastKnownWriteTime" : 1390496601,
    "path" : "~/R/OHI/ice cover and aboriginals2.R",
    "properties" : {
    },
    "source_on_save" : false,
    "type" : "r_source"
}